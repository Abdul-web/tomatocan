<% @title=" need to paginate results "  %>
<p class="flash"><%= flash.notice %></p>

<div class="row">
	<div class="col-xs-10 col-md-offset-2">
		<h1>Perk Sales</h1>
	</div>
</div>

<% if request.host == "crowdpublishtv.herokuapp.com" %> 
  <% if user_signed_in? %>
    <% if @user.id == current_user.id %>
      <% if !current_user.stripeid.present? %>
        <script type="text/javascript">
          window.location.href= "https://connect.stripe.com/oauth/authorize?response_type=code&client_id=ca_6Ws78QidiUJpM70FWAELSMoUDYE37QA9&scope=read_write"
        </script>
      <% end %>
    <% end %>
  <% end %>

<% else %>

<% if user_signed_in? %>
	<% if @user.id == current_user.id %>
    	<% if @user.stripesignup.present? %>
			<div class="col-xs-12">
				<div class="panel panel-primary">
					<div class="panel-heading">Your Sales</div>
					<div class="panel-body">
						<% if @totalinfo.present? %>
							<p>List of all sales - CHECK OFTEN. YOUR FANS MAY BE EXPECTING ITEMS FROM YOU</p>
							<table>
								<tr style='font-weight:bold;'>
									<td>Title</td>
									<td>Author's Share</td>
									<td>Sales Date</td>
									<td>Customer Name</td>
									<td>Shipping Address</td>
									<td>Shipped/ Fulfilled?</td>
								</tr>
							<% @totalinfo.each do |item| %>
								<tr>
									<td><%= item[:soldtitle] %></td>
									<td style='text-align:right' > <%= number_with_precision(item[:authorcut], :precision => 2) %> </td>
									<td> <%= item[:soldwhen] %></td>
									<td> <%= item[:whobought] %></td>
									<td> <%= item[:address] %></td>
									<td>
										<% if item[:fulfillstat] != "sent" && item[:ebook].empty? %>
											<%= button_to [:markfulfilled, @user] do %>
											<strong>Mark as Sent </strong>
											<%= hidden_field_tag :purchid, item[:purchaseid] %>
										<% end %>
										<% else %>
											<%= item[:fulfillstat] %>
										<% end %>
									</td>
								</tr>
							<% end %>
							</table>
						<% end %>
					</div>
				</div>
				<div class="panel panel-primary">
					<div class="panel-heading">Monthly Income</div>
					<div class="panel-body">
						<table class="table">
							<tr>
								<td>Month</td>
								<td>Total Earned (USD)</td> 
							</tr>
							<% @incomeinfo.each do |book| %>
							<tr>
								<td><%= book[:month] %></td>
								<td style='text-align:right'> <%= number_with_precision(book[:monthtotal], :precision => 2) %></td>
							</tr>
							<% end %>
						</table>
					</div>
				</div>
			</div>

    	<% else %>
			<div class="row">
				<div class="col-md-6 col-md-offset-2">
					<div class="panel panel-primary">
						<div class="panel-heading">
							No Sales
						</div>
						<div class="panel-body">
							Sales figures will be displayed on this page
						</div>
					</div>
				</div>
			</div>

		<% end %>
    <% end %>
<% end %>

<% end %>

<%# form_for @user, :url => { :action => "updatebankaccount" } do |f| #what if user changed email address - that ability is currently not enabled in edit profile %>
