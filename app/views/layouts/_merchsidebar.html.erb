
<div class="col-xl-2 col-lg-3 col-md-4 col-sm-5">
    <div class="panel panel-primary">
        <div class="panel-heading">Perks</div>
        <div class="panel-body">
            <!--THIS DOES A WEIRD DESATURATION ON THE PAGE IF I TAKE OUT THE STYLE-->
            <div class="author-books" style="width: 335px; overflow: wrap;">
                <% if @user.merchandises.any? %>
                <% if params[:groupid].present? %>
                    <% groupsupported = Group.find(params[:groupid]) %>
                    5% of purchase will go to <%= groupsupported.name %><br>
                <% end %>
                <% @sidebarmerchandise.each do |merch| %>
                    <% if user_signed_in? %>
                        <% if merch.itempic.present? && merch.itempic != '' %>
                            <table class="table">
                                <tr>
                                    <td>
                                        <%= link_to (image_tag merch.itempic.url.to_s, :style => "max-width:240px"), merchandise_path(merch.id) %>
                                    </td>
                                    <td>
                                        <% if current_user.id == @user.id %>
                                            <%= button_to "Edit Perk", edit_merchandise_path(merch.id), method: :get, form_class: 'btn btn-small', class: 'button' %><br>
                                        <% end %>
                                        <% if @user.stripeid.present? || @user.id == 143 %>
                                            <%= link_to image_tag("buynow.png" ), new_purchase_path( :merchandise_id => merch.id, :group_id => params[:groupid]), method: :get %> 
                                        <% end %>
                                    </td>
                                </tr>
                            </table>
                            <table class="table" style = "width: 330px;">
                                <tr>
                                    <td><%= link_to(merch.name, merchandise_path(merch.id, :groupid => params[:groupid]) ) %></td> 
                                <% if @user.stripeid.present? || @user.id == 143 %>
                                    <td>$<%= sprintf('%.2f', merch.price) %> USD</td> 
                                    <% if (merch.deadline) != nil %>
                                        <% daysaway = (merch.deadline.to_date - Date.today.to_date).to_i %>
                                        <%= "Expires in " + daysaway.to_s + " days"%>
                                    <% end %>
                                <% end %>
                                </tr>
                            </table>
                            <%= truncate(merch.desc, :length => 200, :separator => ' ') %><br><br>
                    <% else %>
                        <table class="table">
                            <tr>
                                <td>
                                    <%= link_to(merch.name, merchandise_path(merch.id, :groupid => params[:groupid]), class: 'link-to-text') %>
                                </td>
                                <td>
                                    <% if current_user.id == @user.id %>
                                        <br><br>
                                        <%= button_to "Edit Perk", edit_merchandise_path(merch.id), method: :get, form_class: 'btn btn-small', class: 'button' %>
                                        <% if (merch.deadline) != nil %>
                                            <% daysaway = (merch.deadline.to_date - Date.today.to_date).to_i %>
                                            <%= "Expires in " + daysaway.to_s + " days"%>
                                                <% if daysaway < 8 %>
                                                    <br><i> Ending Soon! </i>
                                                <% end %>
                                            <% end %>
                                        <% end %>
                                        <% if @user.stripeid.present? || @user.id == 143 %>
                                            <%= link_to image_tag("buynow.png" ), new_purchase_path( :merchandise_id => merch.id, :group_id => params[:groupid]), method: :get %> 
                                        <% end %>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <%= truncate(merch.desc , :length => 200, :separator => ' ') %>
                                </td>
                                <% if @user.stripeid.present? || @user.id == 143 %>
                                    <% if (merch.deadline) != nil %>
                                        <% daysaway = (merch.deadline.to_date - Date.today.to_date).to_i %>
                                        <td>
                                            <%= "Expires in " + daysaway.to_s + " days"%>
                                        </td>
                                    <% end %>
                                <% if merch.price.present? %>
                                    <td>
                                        $<%= sprintf('%.2f', merch.price) %> USD
                                    </td>
                                <% end %>
                                    <% end %>
                            </tr>
                        </table>
                <% end %>

                <% else %>
                    <table class="table">
                        <tr>
                            <td>
                            <% if merch.itempic.present? && merch.itempic != '' %>
                                <%= link_to (image_tag merch.itempic.url.to_s, :style => "max-width:330px"), merchandise_path(merch.id) %><br>
                            <% end %>
                            <%= link_to(merch.name, merchandise_path(merch.id, :groupid => params[:groupid]) ) %></td> </tr>
                    </table>
                    <%= truncate(merch.desc , :length => 200, :separator => ' ') %><br><br>
                <% end %> 

            <% end %> 
        <% end %>
    </div>
</div>