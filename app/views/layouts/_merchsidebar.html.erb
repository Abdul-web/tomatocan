<div class="col-md-4">
<div class="panel panel-primary">
	
<div class="panel-heading">
	Perks
</div>
	
<div class="panel-body">
	<% if @sidebarmerchandise.present? %>
		<% @sidebarmerchandise.each do |merch| %>
		<div class="media">
			<div class="pull-left">
				<%= image_tag merch.itempic.url.to_s, class: "media-object", id: "perkImage" %>
			</div>
			<div class="media-body">
				<h4 class="media-heading">
					<%= link_to(merch.name, merchandise_path(merch.id, :groupid => params[:groupid]) ) %>
				</h4>

				<% if merch.desc.present? %>
					<% if merch.desc.length > 200 %>
						<div>
						<%= truncate(merch.desc, length: 200) %>
						<%= link_to 'more', '', class: "read-more-#{merch.id}" %>
						<script>
							$('.read-more-<%= merch.id %>').on('click', function(e) {
							e.preventDefault()
							$(this).parent().html('<%= escape_javascript merch.desc %>')
											  })
						</script>
						</div>
					<% else %>
						<%= merch.desc %>
					<% end %>
				<% end %>

				<% if user_signed_in? %>
					<% if current_user.id == @user.id %>
					<!--Links to seperate edit perk page-->
					<%= button_to "Edit Perk", edit_merchandise_path(merch.id), method: :get, class: "btn btn-warning pull-right" %>

					<!-- Switch to below button when edit perk form can be shown as a modal-->
					<!--%= button_tag "Edit Perk", class: "btn btn-primary pull-right", "data-toggle" => "modal", "data-target" => "#myModal" %-->
					<% end %>
				<% end %>

				<div>
					<% buyPrice = ("Buy for $" + sprintf('%.2f', merch.price) + "!") %>
					<%= link_to buyPrice, new_purchase_path(:merchandise_id => merch.id), method: :get, :class => "btn btn-warning pull-right", :target => "_blank" %>
				</div>
			</div>
		</div>
		<hr>
	<% end %>
	<% else %>
			<span>No perks :(</span>
	<% end %>
</div>
</div>
</div>