<div id="wrapper">
  <div id="sidebar-wrapper">
  <ul class="sidebar-nav">

  <div class="container" >
  <div class="row" >
  <table><tr><td>
    <% if @user.profilepic.present? && @user.profilepic != '' %>
      <%= image_tag @user.profilepic, :height => "150" %>
    <% elsif @user.profilepicurl %>
      <% if @user.profilepicurl.match(/http/) && @user.profilepicurl.match(/jpeg|jpg|gif|png|tif|GIF|TIF|PNG|JPEG|JPG/) %>
        <%= image_tag @user.profilepicurl, :height => "150" %><br >
      <% else %>
        <%= image_tag "whiteBk.jpg", :height => "150" %>
      <% end %>
    <% else %>
      <%= image_tag "whiteBk.jpg", :height => "150" %>
    <% end %>
  </td><td>
    <div class="username" style = "max-width: 200px; overflow: wrap;">
      <%= @user.name %>
    </div>
    <div class="usergenre" >
      <%= @user.genre1 %><br><%= @user.genre2 %><br><%= @user.genre3 %>
    </div>
  </td></tr></table>
  </div>

  <div class="row" >
    <% if @user == current_user %>
      <% if @user.author == 2 #user is an author %>
        <%= button_to "Edit Profile", user_profileinfo_path(current_user.permalink), :method=> :get %>
        <div class="covername"> <br> </div>
        <% if @mynullagreements.count != 0 %>
          <%= button_to "You have agreement(s) to approve. Click here.", user_projects_path(current_user.permalink), {:style => "background-color:red", :method=> :get} %>
        <% else %> 
          <%= button_to "Edit Projects", user_projects_path(current_user.permalink), :method=> :get %>
        <% end %> 
        <div class="covername"> <br> </div>
        <%= button_to "Edit Books", user_edit_path(current_user.permalink), :method=> :get %>
        <div class="covername"> <br> </div>
        <%= button_to "Edit Merchandise", user_merchandise_path(current_user.permalink), :method=> :get %>
        <div class="covername"> <br> </div>
        <%= button_to "Edit Groups", user_groups_path, :method=> :get %>
        <div class="covername"> <br> </div>
        <%= button_to "Edit Events", user_eventlist_path(current_user.permalink), :method=> :get %>
        <div class="covername"> <br> </div>
        <% if current_user.stripeid.present? %>
          <% if current_user.stripeid.match(/acct/) %>
            <% if @fieldsneeded.present? %>
              <%= button_to "Correct Bank Account Errors", user_correcterrors_path(current_user.permalink), {:style => "background-color:red", :method=> :get} %><br>
            <% else %> 
              <%= button_to "Edit $ Account", user_manageaccounts_path(current_user.permalink), :method=> :get %><br>
            <% end %> 
          <% else %> 
            <%= button_to "Add Bank Account", user_addbankaccount_path(current_user.permalink), :method=> :get %><br>
          <% end %> 
        <% else %> 
          <%= button_to "Get Paid", user_createstripeaccount_path(current_user.permalink), :method=> :get %><br>
        <% end %> 
      <% else #user is NOT an author therefore has not written any books %> 
        <%= button_to "Edit Profile", user_readerprofileinfo_path(current_user.permalink), :method=> :get %>
        <div class="covername"> <br> </div>
        <%= button_to "Edit Groups", groups_path, :method=> :get %>
        <div class="covername"> <br> </div>
        <%= button_to "Edit Events", user_eventlist_path(current_user.permalink), :method=> :get %>
      <% end %> 
    <% end %> 
  </div>

<div class="author-books">
<% if @user.author == 2 %>
  <% if @user.books.any? %>
    <% @user.books.each do |book| %>
      <div class="row" >
        <%= form_for(book) do |f| %>
          <div class="col-md-1 col-sm-1 col-xs-1">
            <div class="fanbook" style="width:75px;height:100px;background-color:#bbdd99; line-height:0.9em; text-align: center; border-width:thin medium medium thin; border-color: 000; border-style: solid" >
              <% if book.coverpic.present? && book.coverpic != '' %>
                <%= link_to image_tag(book.coverpic, :size => "75x100", :title => "Purchase " + book.title), book_path(:id => book.id)  %>
              <% elsif book.coverpicurl.present? && book.coverpicurl.match(/http/) && book.coverpicurl.match(/jpeg|jpg|gif|png|tif|GIF|TIF|PNG|JPEG|JPG/) %>
                <%= link_to image_tag(book.coverpicurl, :size => "75x100", :title => "Purchase " + book.title), book_path(:id => book.id) %>
              <% elsif book.title.match /[0-9A-Za-z]/ %> 
                <%= link_to book.title, book_path(:id => book.id), :class => 'covertitle', :style => 'color:#880000', :title => "Purchase " + book.title %><br><br>
                <%= link_to @user.name, book_path(:id => book.id), :class => 'covername', :style => 'color:#2c3651',  :title => "Purchase " + book.title %><br>
              <% end %>
            </div><br>
          </div>
          <div class="col-md-8 col-sm-8 col-xs-8 book-info">
              <div class="fanbook" style= "font-weight:bold">
                <%= link_to book.title, book_path(:id => book.id), :style => 'color:#2c3651', :title => "Learn more about " + book.title %>
              </div>
              <div class="fanbook">
                &nbsp<%= book.genre %><br>
              </div>
            <div class="fifty"><br><%= link_to book.fiftychar, book_path(:id => book.id), :style => 'color:#2c3651', :title => "Learn more about " + book.title  %> </div><br>
          </div>
        <% end #form_for %>
      </div>
    <% end #@user.bks.each do %> 
    <br><br>
  <% else %>
    <div style = "max-width: 330px;  overflow: wrap;">
    <% if @user == current_user %>
      <p>Click on Edit Books to list your writings - even those in progress - so this sidebar won't be empty when your fans view it!. </p>
    <% end %>
    </div>
  <% end %>
<% else # sidebar for reader%>
<% end %>
</div>
</ul>
</div>
</div>
</div>
